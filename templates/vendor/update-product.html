{% extends 'vendor/account_header.html'%} 
{% load staticfiles %} 
{% block content %}
<script src="https://cdn.ckeditor.com/4.6.2/standard/ckeditor.js"></script>
<div class="col-md-9">
   <div class="profile-content">
      <div class="panel panel-info">
         <div class="panel-heading" style="background:#daac0a;">
            <h3 class="panel-title" style="color: white;text-align: center;">ACTUALIZAR PRODUCTO</h3>
         </div>
         <div class="panel-body">
            <div class="row">
               <div class=" col-md-12 col-lg-12">
                  <form class="form-horizontal form_custom_edit" id="product_form" method="post" action="{% url 'Vendor:add-product' %}" enctype="multipart/form-data">
                     {% csrf_token %}
                     <fieldset>
                        <div class="form-group" style="display: none">
                           <div class="col-sm-9">
                              <input type="text" class="form-control" name="product_id" value="{{add_form.id}}" />
                           </div>
                        </div>
                        <div class="form-group">
                           <label class="control-label col-sm-3">Título</label>
                           <div class="col-sm-9">
                              <input type="text" class="form-control" name="title" value="{{add_form.title}}" /> {% if add_form.errors.title %}
                              <strong style="color:red">{{ add_form.errors.title | escape }}</strong> {% endif %}
                           </div>
                        </div>
                        <div class="form-group">
                           <label class="control-label col-sm-3">Categoría</label>
                           <div class="col-sm-9">
                              <select class="form-control selectpicker" name="category" id="id_category">
                                 {% for category in categories %}
                                 <option value="{{category.id}}">{{category.category_name}}</option>
                                 {% endfor %}
                              </select>
                              {% if add_form.errors.category %}
                              <strong style="color:red">{{ add_form.errors.category | escape }}</strong> {% endif %}
                           </div>
                        </div>
                        <div class="form-group">
                           <label class="control-label col-sm-3">Subcategoría</label>
                           <div class="col-sm-9">
                              <select class="form-control selectpicker" name="subs_category" id="id_subs_category">
                              </select>
                              {% if add_form.errors.subs_category %}
                              <strong style="color:red">{{ add_form.errors.subs_category | escape }}</strong> {% endif %}
                           </div>
                        </div>
                        <div class="form-group" id="product_type_size">
                           <label class="control-label col-sm-3">Type of Product</label>
                           <div class="col-sm-9">
                              <div class="row">
                                 <div class="col-sm-6">
                                 {% for p in producttype %}
                                    <div class="form-check">
                                       <div class="form-check-label">
                                          <input type="radio" class="form-check-input" name="product_type" value="{{p.p_type}}" id='{{p.p_type}}_RADIO' {% ifequal add_form.product_type p.p_type %}checked{% endifequal %}>
                                       {{p.p_type}}
                                       {% if s_form.errors.product_type %}
                                       <strong style="color:red">{{ s_form.errors.product_type | escape }}</strong> {% endif %}
                                       </div>
                                    </div>
                                 {% endfor %}
                                 </div>
                                 <div class="col-sm-6" id="size_container">
                                 </div>
                              </div>
                           </div>
                        </div>
                        <div class="form-group">
                           <label class="control-label col-sm-3">Precio del producto($)</label>
                           <div class="col-sm-9">
                              <input type="text" class="form-control" name="price" id="price_id" value="{{add_form.price|floatformat:2}}" /> {% if add_form.errors.price %}
                              <strong style="color:red">{{ add_form.errors.price | escape }}</strong> {% endif %}
                           </div>
                        </div>
                        <div class="form-group">
                           <label class="control-label col-sm-3">Precio de venta($)</label>
                           <div class="col-sm-9">
                              <input type="text" class="form-control" name="selling_price" id="sell_price_id" value="{{add_form.selling_price|floatformat:2}}" /> 
                              {% if add_form.errors.selling_price %}
                              <strong style="color:red">{{ add_form.errors.selling_price | escape }}</strong> 
                              {% endif %}
                           </div>
                        </div>
                        <input type="hidden" name="muti_image_array" id="muti_image_array">
                        <div class="form-group">
                           <label class="control-label col-sm-3">Subir foto☀️</label>
                           <div class="col-sm-9 file-preview-input">
                              <div id="image_preview"><img src="{% static 'img/no-image.jpg'%}"></div>
                              {% if add_form.image %}
                              <div class="row" id='product_image' name='product_image' style="margin-top: 10px">
                                 {% for img in add_form.image %}
                                 <div class="col-sm-2" id="remove_photo_{{forloop.counter}}">
                                    <div>
                                       <i class="fa fa-times" aria-hidden="true" style="color:black;float:right"></i>
                                       <img src="{{img}}" style="width: 100%">
                                    </div>
                                 </div>
                                 <script type="text/javascript">
                                    $("#remove_photo_{{forloop.counter}}").on("click",function(){
                                       $.ajax({
                                          url: "{% url 'Vendor:delete-product-image' %}",
                                          type: 'POST',
                                          dataType: 'json',
                                          data: {
                                             "img":$('#remove_photo_{{forloop.counter}} img').attr('src'),
                                             "product":{{add_form.id}},
                                              'csrfmiddlewaretoken': '{{ csrf_token }}'
                                          },
                                          success: function(e) {
                                             if(e.status==200){
                                                $("#remove_photo_{{forloop.counter}}").remove()
                                             }
                                          }
                                      });
                                    });
                                 </script>
                                 {% endfor %}
                              </div>
                              {% else %}
                              <div class="row" id='product_image' name='product_image' style="margin-top: 10px"></div>
                              {% endif %}
                              <span class="glyphicon glyphicon-folder-open" style="margin-top: 10px"></span>
                              <span class="file-preview-input-title" style="margin-top: 10px">Agregar imagen del producto</span>
                              <input type="file" name="image" id="image" accept=".jpg, .jpeg, .png">
                              {% if add_form.errors.image %}
                              <strong style="color:red">{{ add_form.errors.image|escape}}</strong>
                              {% endif %}
                           </div>
                        </div>
                        <div class="form-group">
                           <label class="control-label col-sm-3">Monto Asegurado</label>
                           <div class="col-sm-9">
                              <input type="text" class="form-control" name="insured_amount" value="{{add_form.insured_amount|floatformat:2}}" placeholder="Enter Insured Amount" maxlength="16" id="mobile_id" onkeypress="return isNumber(event);"> {% if add_form.errors.insured_amount %}
                              <strong style="color:red">{{ add_form.errors.insured_amount | escape }}</strong> {% endif %}
                           </div>
                        </div>
                        <div class="row">
                           <div class="col-md-3">
                              <label class="control-label">Peso del Producto</label>
                              <div class="form-group">
                                 <div class="col-sm-12">
                                    <input type="text" class="form-control" name="product_weight" value="{{add_form.product_weight|floatformat:2}}" placeholder="Enter Product Weight" maxlength="16" id="mobile_id"> {% if add_form.errors.product_weight %}
                                    <strong style="color:red">{{ add_form.errors.product_weight | escape }}</strong> {% endif %}
                                 </div>
                              </div>
                           </div>
                           <div class="col-md-3">
                              <label class="control-label">Altura del producto</label>
                              <div class="form-group">
                                 <div class="col-sm-12">
                                    <input type="text" class="form-control" name="product_height" value="{{add_form.product_height|floatformat:2}}" placeholder="Enter Product height" maxlength="50"> {% if add_form.errors.product_height %}
                                    <strong style="color:red">{{ add_form.errors.product_height | escape }}</strong> {% endif %}
                                 </div>
                              </div>
                           </div>
                           <div class="col-md-3">
                              <label class="control-label">Product Depth</label>
                              <div class="form-group">
                                 <div class="col-sm-12">
                                    <input type="text" class="form-control" name="product_depth" value="{{add_form.product_depth|floatformat:2}}" id="state" placeholder="Enter Product Depth" maxlength="50"> {% if add_form.errors.product_depth %}
                                    <strong style="color:red">{{ add_form.errors.product_depth | escape }}</strong> {% endif %}
                                 </div>
                              </div>
                           </div>
                           <div class="col-md-3">
                              <label class="control-label">Ancho del producto</label>
                              <div class="form-group">
                                 <div class="col-sm-12">
                                    <input type="text" class="form-control" name="product_width" value="{{add_form.product_width|floatformat:2}}" id="country" placeholder="Enter Product Width" maxlength="50"> {% if add_form.errors.product_width %}
                                    <strong style="color:red">{{ add_form.errors.product_width | escape }}</strong> {% endif %}
                                 </div>
                              </div>
                           </div>
                        </div>
                        <div class="row" style="padding: 0px 15px">
                           <div class="col-sm-6">
                              <div class="form-group" style="padding-right:5px">
                                 <label class="control-label" style="padding-bottom: 5px">Descripción</label>
                                 <textarea class="form-control" placeholder="Include the Brand, Model, Age and other details.." name="description" value="{{add_form.description}}">{{add_form.description | safe}}</textarea>
                                 {% if add_form.errors.description %}
                                 <strong style="color:red">{{ add_form.errors.description | escape }}</strong> {% endif %}
                              </div>
                           </div>
                           <div class="col-sm-6">
                              <div class="form-group" id="id_feature" style="padding-left:5px">
                                 <label class="control-label" style="padding-bottom: 5px">Caracteristicas</label>
                                 <textarea class="form-control" placeholder="Include Features Details.. " name="feature" value="{{add_form.feature}}">{{add_form.feature | safe}}</textarea>
                                 {% if add_form.errors.feature %}
                                 <strong style="color:red">{{ add_form.errors.feature | escape }}</strong> {% endif %}
                              </div>
                           </div>
                        </div>
                        <div class="form-group">
                           <label class="control-label col-sm-3" for="id_in_stock">Disponible</label>
                           <div class="col-sm-1">
                              {% if add_form.in_stock %}
                              <input id="id_in_stock" checked="checked" name="in_stock" type="checkbox"> {% else %}
                              <input id="id_in_stock" name="in_stock" type="checkbox"> {% endif %} {% if add_form.errors.in_stock %}
                              <strong style="color:red">{{ add_form.errors.in_stock | escape }}</strong> {% endif %}
                           </div>
                           <div class="col-sm-8">
                              <input type="text" class="form-control" name="product_quantity" id="product_quantity_id" value="{{add_form.product_quantity}}" /> {% if add_form.errors.product_quantity %}
                              <strong style="color:red">{{ add_form.errors.product_quantity | escape }}</strong> {% endif %}
                           </div>
                        </div>
                        <h4 class="heading_info">Detalles del método de pago del producto</h4>
                        <div class="form-group">
                           <div class="row" style="padding: 0px 15px">
                              <div class="col-md-3">
                                 <div class="form-group">
                                    <label class="control-label col-sm-8">Todas</label>
                                    <div class="col-sm-4">
                                       {% if "COD,Online,Paypal" in add_form.payment_mode %}
                                       <input name="all" checked="checked" type="checkbox" id='all_payment'>
                                       {% else %}
                                       <input name="all" type="checkbox" id='all_payment'>
                                       {% endif %}
                                    </div>
                                 </div>
                              </div>
                              <div class="col-md-3">
                                 <div class="form-group">
                                    <label class="control-label col-sm-8">Pago contra entrega</label>
                                    <div class="col-sm-4">
                                       {% if 'COD' in add_form.payment_mode %}
                                       <input name="payment_method_case_on_delivery" checked="checked" type="checkbox" id='payment_method_case_on_delivery'> 
                                       {% else %}
                                       <input name="payment_method_case_on_delivery" type="checkbox" id='payment_method_case_on_delivery'>
                                       {% endif %}
                                    </div>
                                 </div>
                              </div>
                              <div class="col-md-3">
                                 <div class="form-group">
                                    <label class="control-label col-sm-8">Pago en línea</label>
                                    <div class="col-sm-4">
                                       {% if 'Online' in add_form.payment_mode %}
                                       <input name="payment_method_online_payment" checked="checked" type="checkbox" id='payment_method_online_payment'> 
                                       {% else %}
                                       <input name="payment_method_online_payment" type="checkbox" id='payment_method_online_payment'> {% endif %}
                                    </div>
                                 </div>
                              </div>
                              <div class="col-md-3">
                                 <div class="form-group">
                                    <label class="control-label col-sm-8">Pago a través de Paypal</label>
                                    <div class="col-sm-4">
                                       {% if 'Paypal' in add_form.payment_mode %}
                                       <input name="payment_method_paypal" checked="checked" type="checkbox" id='payment_method_paypal'> 
                                       {% else %}
                                       <input name="payment_method_paypal" type="checkbox" id='payment_method_paypal'>
                                       {% endif %}
                                    </div>
                                 </div>
                              </div>
                           </div>
                        </div>
                        <div class="form-group" style="display:none;">
                           <input type="text" class="form-control" name="payment_mode" id='payment_mode'>
                        </div>
                        <div class="form-group">
                           <div class="col-sm-12">
                              <div class="form-group">
                                 <label class="control-label col-sm-2">Servicios</label>
                                 <div class="col-sm-10">
                                    <textarea class="form-control" placeholder="Include Services.." name="services" value="{{add_form.feature}}">
                                    {{add_form.services | safe}}</textarea>
                                 </div>
                              </div>
                           </div>
                        </div>
                        <h4 style="color:#daac0a">Colores e imágenes del producto</h4>
                        <div class="form-group">
                           <div class="col-md-12">
                              <div class="form-group">
                                 <div class="col-sm-12 input_fields_wrap">
                                    {% for color in add_form.productColor.all %}
                                    <div class="color-box">
                                       <div class="form-group">
                                          <label class="control-label col-sm-12" style="color:#daac0a">Color del producto</label>
                                          <div class="row">
                                             <div class="col-sm-5">
                                                <label class="control-label col-sm-6" style="color:#daac0a">Imagen de color del producto</label>
                                                <input id="id_product_colors-{{forloop.counter}}-color" class="colorfield_field" name="product-colors-{{forloop.counter}}-color" value="{{color.color}}" type="color">
                                             </div>
                                             <div class="col-sm-7">
                                                <a href="#" class="add_color_image btn btn-success btn-sm col-sm-4">Añadir imagen <i class="fa fa-plus" aria-hidden="true" style="color:white"></i></a>
                                                <ol class="col-sm-8 product_images" style="    list-style-type:none">
                                                   {% for image in color.product_color_images.all %}
                                                   <div style="padding: 0px ! important">
                                                      <li>
                                                         <input type="file" name="product_colors-{{forloop.parentloop.counter}}-product-color-images-{{forloop.counter}}-product-images" onChange="preview_color_images(this, as{{image.id}})">
                                                      </li>
                                                      <div class="col-md-12" id="as{{image.id}}">
                                                         {% if image.product_images.name %}
                                                         <img src="{{image.product_images.name}}" style="width:40%;"> {% else %}
                                                         <img src="{{image.product_images.url}}" style="width:40%;"> {% endif %}
                                                         <a href="#" class="remove_color_field1 btn btn-danger btn-xs">Retirar <i class="fa fa-times" aria-hidden="true"></i></a>
                                                      </div>
                                                   </div>
                                                   {% endfor %}
                                                </ol>
                                             </div>
                                          </div>
                                       </div>
                                       <a class="remove_color_field btn btn-danger btn-sm" id='{{color.id}}' style="float:right">Retirar <i class="fa fa-times" aria-hidden="true"></i></a>
                                    </div>
                                    {% endfor %}
                                 </div>
                              </div>
                           </div>
                        </div>
                     </fieldset>
                     <!-- <input type="hidden" name="response_total_color" value="{{total_color}}"> -->
                     <input type="hidden" name="total_color" id="id_total_color" value="{{total_color}}">
                     <input type="hidden" id="id_total_color_images" value="{{total_image}}">
                     <div class="form-group">
                        <div class="row edit-sec-btn" style="padding: 0px 15px">
                           <div class="col-md-6">
                              <button class="btn btn-custom pull-right add_field_button" type="button"  style="float: left !important;">Añadir color <i class="fa fa-plus" aria-hidden="true"></i></button>
                           </div>
                           <div class="col-md-6">
                              <input type="submit" class="btn btn-success pull-right" value="✅ Enviar" id="submit_form">
                           </div>
                        </div>
                     </div>
                  </form>
               </div>
            </div>
         </div>
      </div>
   </div>
</div>
{% if add_form.category.id %}
<script type="text/javascript">
   $("#id_category").val({{add_form.category.id}})
</script>
{% endif %}
{% if add_form.subs_category.id %}
<script type="text/javascript">
   sub_category_value = '{{add_form.subs_category.id}}'
</script>
{% endif %}
{% if add_form.product_type.value %}
<script type="text/javascript">
   product_type_selected = "{{add_form.product_type.value}}"
</script>
{% else %}
<script type="text/javascript">
   product_type_selected = undefined
</script>
{% endif %}
{% if add_form.product_size.value %}
<script type="text/javascript">
   product_size_selected = "{{add_form.product_size.value}}"
</script>
{% else %}
<script type="text/javascript">
   product_size_selected = undefined
</script>
{% endif %}
{% if add_form.product_size %}
<script type="text/javascript">
   update_product_size_selected = "{{add_form.product_size}}"
</script>
{% else %}
<script type="text/javascript">
   update_product_size_selected = undefined
</script>
{% endif %}
{% if add_form.productColor.all %}
<script type="text/javascript">
   colorCount = '{{add_form.productColor.count}}'
</script>
{% else %}
<script type="text/javascript">
   colorCount = 0
</script>
{% endif %}
<script>
   $(document).ready(function() {
      $("#product_type_size").hide()
      $("#product_quantity_id").blur(function() {
           var val = $("#product_quantity_id").val();
           if (val > 0) {
               $("#id_in_stock").prop("checked", true)
   
           } else {
               $("#id_in_stock").prop("checked", false)
           }
       });
      categoryChange = function(value) {
           $.ajax({
               url: "{% url 'Vendor:subcategories'%}",
               type: 'POST',
               dataType: 'json',
               data: {
                   category_id: value,
                   'csrfmiddlewaretoken': '{{ csrf_token }}',
               },
               success: function(e) {
                   var str = "";
                   $(e.data).each(function(index, value) {
                       str += "<option value =" + value['id'] + ">" + value['sub_category_name'] + "</option>"
                   });
                   $("#id_subs_category").empty().append(str);
                   if(sub_category_value){
                     $("#id_subs_category").val(sub_category_value)
                     sub_category_value = undefined
                     sub_category_change();
                   }
               }
           });
       }
       function set_size_container_data(value){
            $.ajax({
               url: "{% url 'Vendor:get-product-size'%}",
               type: 'POST',
               dataType: 'json',
               data: {
                   value: value,
                   'csrfmiddlewaretoken': '{{ csrf_token }}',
               },
               success: function(e) {
                  product_size = []
                  $("#size_container").empty()
                  $("#size_container").append("<p>Please select size for your Product</p>")
                  $("#size_container").append('<input type="hidden" name="product_size" id="product_size"/>')
                  if(update_product_size_selected){
                     product_size_selected = update_product_size_selected
                  }
                  for(i=0;i<e.data.length;i++){
                     if((product_size_selected && product_size_selected.includes(e.data[i])) || (product_size_selected && product_size_selected.includes(e.data[i])) ){
                        $("#size_container").append(' <input type="checkbox" name="product_size_value" value="'+e.data[i]+'" checked=true/> '+ e.data[i])
                           product_size.push(e.data[i])
                     }
                     else{
                        $("#size_container").append(' <input type="checkbox" name="product_size_value" value="'+e.data[i]+'"/> '+ e.data[i])
                     }
                  }
                  $('input[type=checkbox][name=product_size_value]').on('change',function () {
                        if($(this).prop("checked") == true){
                           product_size.push($(this).val())
                        }
                        else if($(this).prop("checked") == false){
                           product_size.splice(product_size.indexOf($(this).val()), 1)
                           console.log(product_size+"--"+$(this).val())
                        }
                        $("#product_size").val(product_size)
                  });
               }
            });
         }

         $('input[type=radio][name=product_type]').on('change',function () {
               set_size_container_data($(this).val())
         });

       function sub_category_change(){
         $.ajax({
            url: "{% url 'Vendor:subcategory-tag'%}",
            type: 'POST',
            dataType: 'json',
            data: {
                subcategory_id: $("#id_subs_category").val(),
                'csrfmiddlewaretoken': '{{ csrf_token }}',
            },
            success: function(e) {
                if(e.data=="CP"){
                  $("#product_type_size").show()
                }else{
                  $("#product_type_size").hide()
                }
            }
         });
         if(product_type_selected){
            $('input[type=radio][name=product_type]').filter('[value='+product_type_selected+']').attr('checked', true);
            set_size_container_data(product_type_selected)
         }
      }
       $("#id_category").on('change',function(){
         categoryChange($("#id_category").val())
       });
       $("#id_subs_category").on('change',function(){
         sub_category_change()
       });
      categoryChange($("#id_category").val())
      set_size_container_data($('input[type=radio][name=product_type]:checked').val())
      $("#product_quantity_id").blur(function() {
           var val = $("#product_quantity_id").val();
           if (val > 0) {
               $("#id_in_stock").prop("checked", true)
   
           } else {
               $("#id_in_stock").prop("checked", false)
           }
       });
      $("#id_in_stock").on('change',function(){
          if($(this).is(":checked")) {
              $("#product_quantity_id").show()
          }else{
              $("#product_quantity_id").hide()
          }
       })
      $("#all_payment").on('change',function(){
          if($(this).is(":checked")) {
               $("#payment_mode").val(['COD','Online','Paypal'])
               $("#payment_method_case_on_delivery").prop("checked", true)
               $("#payment_method_online_payment").prop("checked", true)
               $("#payment_method_paypal").prop("checked", true)
          }else{
               $("#payment_mode").val(undefined)
               $("#payment_method_case_on_delivery").prop("checked", false)
               $("#payment_method_online_payment").prop("checked", false)
               $("#payment_method_paypal").prop("checked", false)
          }
       })
   
      function all_select(){
         if($("#payment_method_case_on_delivery").is(":checked") && $("#payment_method_online_payment").is(":checked") && $("#payment_method_paypal").is(":checked")){
               $("#payment_mode").val(['COD','Online','Paypal'])
               $("#all_payment").prop("checked", true)
         }else{
            $("#payment_mode").val(undefined)
            var arr = []
            if($("#payment_method_case_on_delivery").is(":checked"))
               arr.push('COD')
            if($("#payment_method_online_payment").is(":checked"))
               arr.push('Online')
            if($("#payment_method_paypal").is(":checked"))
               arr.push('Paypal')
            $("#payment_mode").val(arr)
            $("#all_payment").prop("checked", false)
         }
       }
       $("#payment_method_case_on_delivery").on('change',function(){
            all_select();
       })
       $("#payment_method_online_payment").on('change',function(){
            all_select();
       })
       $("#payment_method_paypal").on('change',function(){
            all_select();
       })
      all_select();
      multiple_Image_Array = []
       $("#image").on('change', function() {
           var countFiles = $(this)[0].files.length;
           var imgPath = $(this)[0].value;
           var extn = imgPath.substring(imgPath.lastIndexOf('.') + 1).toLowerCase();
           var image_holder = $("#image_preview");
           if (extn == "gif" || extn == "png" || extn == "jpg" || extn == "jpeg") {
               if (typeof(FileReader) != "undefined") {
                   for (var i = 0; i < countFiles; i++) {
                       var reader = new FileReader();
                       reader.onload = function(e) {
                           image_holder.empty();
                           $("<img />", {
                               "src": e.target.result,
                               "class": "thumb-image"
                           }).appendTo(image_holder);
                           $.ajax({
                              url: "{% url 'Vendor:upload-image'%}",
                              type: 'POST',
                              dataType: 'json',
                              data: {
                                  "image": e.target.result,
                                  'csrfmiddlewaretoken': '{{ csrf_token }}',
                              },
                              success: function(e) {
                                 if(e.status==200){
                                    multiple_Image_Array.push(e.image)
                                    $("#muti_image_array").val(multiple_Image_Array)
                                 }
                              }
                           });
                           $("#product_image").append('<div class="col-sm-2" id="remove_photo_business_'+(--countFiles)+'"><div><i class="fa fa-times" aria-hidden="true" style="color:black;float:right;display:none;"></i><img src="'+e.target.result+'"%}" style="width: 100%;padding-top:20px;"></div></div>')
                       }
                       image_holder.show();
                       reader.readAsDataURL($(this)[0].files[i]);
                   }
               } else {
                   alert("This browser does not support FileReader.");
               }
           } else {
               Lobibox.alert('error', {
                   sound: false,
                   msg: 'Please upload valid image.'
               });
               this.value = "";
           }
       });
   
       var max_fields = 5; //maximum input boxes allowed
       var wrapper = $(".input_fields_wrap"); //Fields wrapper
       var add_button = $(".add_field_button"); //Add button ID
       var x = colorCount; //initlal text box count
       $(add_button).click(function(e) { //on add input button click
           e.preventDefault();
           if (x <= max_fields) {
               x++; //text box increment
               $(wrapper).append('<div class="color-box">\
                  <div class="form-group">\
                     <label class="control-label col-sm-12" style="color:#daac0a">Color del Producto</label>\
                     <div class="row">\
                        <div class="col-sm-5">\
                           <label class="control-label col-sm-6" style="color:#daac0a">Imagen de color del producto</label>\
                           <input id="id_product_colors-' + (x) + '-color" class="colorfield_field" name="product-colors-'+(x)+'-color" value="#FFFFFF" type="color">\
                        </div>\
                        <div class="col-sm-7">\
                           <a href="#" class="add_color_image btn btn-success btn-sm col-sm-4">Añadir Imagen <i class="fa fa-plus" aria-hidden="true" style="color:white"></i></a>\
                           <ol class="col-sm-8 product_images" ></ol>\
                        </div>\
                     </div>\
                  </div>\
                  <a href="#" class="remove_color_field btn btn-danger btn-sm" style="float:right">Retirar <i class="fa fa-times" aria-hidden="true"></i></a>\
                  </div>'); //add input box
           } else {
               alert("You can't add more than 5 Colors")
               return
               $(".add_field_button").css({
                   'display': 'none'
               });
           }
           $("#id_total_color").val(x);
       });
   
       $(wrapper).on("click", ".remove_color_field", function(e) { 
              e.preventDefault();
              id = $(this).attr('id') 
              obj = $(this)
               $.ajax({
               url: "{% url 'Vendor:delete-colors' %}",
               type: 'POST',
               dataType: 'json',
               data: {
                  "id":id,
                   'csrfmiddlewaretoken': '{{ csrf_token }}',
               },
               success: function(e) {
                  if(e.status==200){
                      obj.parent('div').remove();
                      x--;
                      $(".add_field_button").css({
                          'display': 'block'
                      });
                      $("#id_total_color").val(x - 1);
                  }
               }
           });
               
           })
       var max_fields_img = 17; //maximum input boxes allowed
       var y = 0; //initlal text box count
       $(wrapper).on("click", ".add_color_image", function(e) { //on add input button click
           e.preventDefault();
           if (y < max_fields_img) { //max input box allowed
               y++; //text box increment
               var id = "as" + (y + 1).toString();
               $(this).parent().find('.product_images').append('<div class="col-md-12"> \
                  <div class="col-md-12">\
                  <input type="file" name="product-colors-'+(x)+'-product-color-images-'+(y)+'-product-images" \
                      onChange="preview-color-images(this,'+id+');" required=""> </div><div class="col-md-12" id=' + id + '>\
                          <img src="" style="width:40%;">\
                           <a href="#" class="remove_color_field1 btn btn-danger btn-xs">Retirar <i class="fa fa-times" aria-hidden="true"></i></a>\
                  </div>\
                  </div>'); //add input box
           }
           $("#id_total_color_images").val(y);
       });
   
       $(wrapper).on("click", ".remove_color_field1", function(e) { //user click on remove text
           e.preventDefault();
           $(this).parent().parent('li').remove();
           y--;
           $("#id_total_color_images").val(y - 1);
       });
       $('#product_form').submit(function(e) {
           if ($("#sub_tag").text() == "CP") {
               color_counter = $("#id_total_color").val();
               image_counter = $("#id_total_color_images").val();
               if (color_counter <= 0) {
                   e.preventDefault();
                   $(".add_field_button").css({
                       'border-color': 'red',
                       'box-shadow': '0 1px 8px 1px red'
                   });
                   $(".add_field_button").focus();
                   Lobibox.alert('warning', {
                       showClass: 'fadeInDown',
                       hideClass: 'fadeUpDown',
                       sound: false,
                       position: 'center',
                       msg: 'Please add atleast one color for this product !'
                   });
                   return false;
               } else {
                   if (image_counter <= 0) {
                       e.preventDefault();
                       $(".add_color_image").css({
                           'border-color': 'red',
                           'box-shadow': '0 1px 8px 1px red'
                       });
                       $(".add_color_image").focus();
                       Lobibox.notify('error', {
                           showClass: 'fadeInDown',
                           hideClass: 'fadeUpDown',
                           sound: false,
                           msg: 'Please add atleast one image for this color !'
                       });
                       return false;
                   } else {
   
                       return true;
                   }
               }
           }
       });
   });
   function preview_color_images(file, img_id) {
     //Get count of selected files
     var countFiles = $(file)[0].files.length;
     var imgPath = $(file)[0].value;
     var extn = imgPath.substring(imgPath.lastIndexOf('.') + 1).toLowerCase();
     console.log($(img_id).attr('id'));
     var image_holder = $('#' + $(img_id).attr('id'));
   
     if (extn == "gif" || extn == "png" || extn == "jpg" || extn == "jpeg") {
         if (typeof(FileReader) != "undefined") {
             for (var i = 0; i < countFiles; i++) {
                 var reader = new FileReader();
                 reader.onload = function(e) {
                     image_holder.find('img').remove();
                     $("<img />", {
                         "src": e.target.result,
                         "class": "thumb-image",
                         "style": "width:40%",
                     }).prependTo(image_holder);
                 }
                 image_holder.show();
                 reader.readAsDataURL($(file)[0].files[i]);
             }
         } else {
             alert("This browser does not support FileReader.");
         }
     } else {
         Lobibox.alert('error', {
             sound: false,
             msg: 'Please upload valid image.'
         });
         file.value = "";
     }
   }
   $("#price_id, #sell_price_id").attr('maxlength', '10');
   $("#price_id, #sell_price_id").on('keypress', function(evt) {
       var charCode = (evt.which) ? evt.which : event.keyCode
       if (charCode > 31 && (charCode < 48 || charCode > 57))
           return false;
       return true;
   });
</script>
<script>
   CKEDITOR.replace('description');
   CKEDITOR.replace('feature');
   CKEDITOR.replace('services');
</script>
<link rel="stylesheet" href="{% static 'css/lobibox.css' %}" />
<script src="{% static  'js/lobibox.js' %}"></script>
{% if messages %} 
{% for message in messages %}
<script>
   Lobibox.notify('{{ message.tags }}', {
       size: 'mini',
       showClass: 'fadeInDown',
       hideClass: 'fadeUpDown',
       sound: false,
       msg: '{{ message.message }}'
   });
</script>
{% endfor %}
{% endif %}
{% endblock %}